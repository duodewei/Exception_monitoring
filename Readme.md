## 需求
编写一个异常数据监控的自动化检测程序，从数据库中下载订单信息后，将数据进行汇总分析后生成.csv文件，然后对该.csv文件进行分析，将分析结果自动发送到指定邮箱，选择Python作为编程语言。



## 逻辑


### 一.从数据库中下载订单信息
#### 1.连接数据库
选择MySQL数据库，选择数据库服务器所在的主机、登陆用户名、登陆用户密码、连接的数据库、数据库开放的端口等参数，连接数据库
#### 2.获取订单信息
连接数据库后，获取cursor对象，执行查询和获取结果，输入获取数据的SQL语句
#### 3.从oms中获取订单的详细信息
结合异常数据类型以及数据库存储信息，下载订单号，客户名称，所属租户，订单来源（承运商下单、excel导入、六合对接、乳业导入、WMS下单、虚拟订单），下单时间，下单员，起运站点编码，起运省，起运市，起运区，起运详细地址，送货站点编码，送货省，送货市，送货区，送货详细地址，承运人
#### 4.从bms中站点库信息
从bms数据库中下载起运站点编码、送货站点编码、经度、纬度等信息
#### 5.写入本地数据库
将订单信息存储为"站点库.csv"，将站点信息存储为"订单信息.csv"


### 二.分析异常数据

#### 1.创建表头
以为从数据库中下载的数据没有表头，所以创建表头为：['订单号', '客户名称','所属租户', '订单来源','下单时间', '下单员','起运站点编码','起运省', '起运市','起运区', '起运详细地址','送货站点编码','送货省', '送货市', '送货区','送货详细地址','承运人']

#### 2.检索异常数据
- 抓取"起运站点编码为空,省市区详细地址都不为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"起运站点编码为空，省市区详细地址都为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"起运站点编码为空，省市区详细地址不全为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"起运站点编码有但不存在站点库中"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"起运站点编码有存在站点库中，省市区详细地址都为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"起运站点编码有存在站点库中，省市区详细地址不全为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"起运站点编码有存在站点库中，省市区详细地址都不为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"送货站点编码为空,省市区详细地址都不为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"送货站点编码为空，省市区详细地址都为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"送货站点编码为空，省市区详细地址不全为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"送货站点编码有但不存在站点库中"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"送货站点编码有存在站点库中，省市区详细地址都为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"送货站点编码有存在站点库中，省市区详细地址不全为空"的数据，在后面添加一列"异常类型"，写入该异常
- 抓取"送货站点编码有存在站点库中，省市区详细地址都不为空"的数据，在后面添加一列"异常类型"，写入该异常

#### 3.将所有的异常订单信息和异常类型写入"异常情况汇总报告.csv"

#### 4.统计异常订单类型
统计每种错误类型的个数，并将错误类型的个数写入"异常订单详情.csv"

### 三.自动发送邮件

#### 1.设置邮箱域名、发件人邮箱、邮箱授权码、收件人邮箱
#### 2.构建邮件对象，并添加附件："异常情况汇总报告.csv"和"异常订单详情.csv"文件
#### 3.添加正文文本并发送



## 代码介绍
- core文件存放逻辑文件，Download_data：下载数据；Analyse_data：分析数据；Emaile_data：发送数据
- data为测试数据，目前还没有从数据库导入，测试数据暂为空
- run是运行主程序

##效果
#### 1.异常订单详情.csv文件截图
！[内容自填](https://github.com/duodewei/Exception_monitoring/blob/master/1.png)
#### 2.异常情况汇总报告.csv文件截图
！[内容自填](https://github.com/duodewei/Exception_monitoring/blob/master/2.png)
#### 3.邮箱收到内容截图
！[内容自填](https://github.com/duodewei/Exception_monitoring/blob/master/3.png)
